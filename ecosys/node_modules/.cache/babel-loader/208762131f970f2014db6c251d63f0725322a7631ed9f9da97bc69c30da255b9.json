{"ast":null,"code":"import \"core-js/modules/es.array.push.js\";\nimport { Util } from 'leaflet';\nimport featureLayerService from '../../Services/FeatureLayerService';\nimport { getUrlParams, warn, setEsriAttribution, removeEsriAttribution } from '../../Util';\nimport { FeatureGrid } from './FeatureGrid';\nimport BinarySearchIndex from 'tiny-binary-search';\nexport var FeatureManager = FeatureGrid.extend({\n  /**\r\n   * Options\r\n   */\n\n  options: {\n    attribution: null,\n    where: '1=1',\n    fields: ['*'],\n    from: false,\n    to: false,\n    timeField: false,\n    timeFilterMode: 'server',\n    simplifyFactor: 0,\n    precision: 6,\n    fetchAllFeatures: false\n  },\n  /**\r\n   * Constructor\r\n   */\n\n  initialize: function (options) {\n    FeatureGrid.prototype.initialize.call(this, options);\n    options = getUrlParams(options);\n    options = Util.setOptions(this, options);\n    this.service = featureLayerService(options);\n    this.service.addEventParent(this);\n\n    // use case insensitive regex to look for common fieldnames used for indexing\n    if (this.options.fields[0] !== '*') {\n      var oidCheck = false;\n      for (var i = 0; i < this.options.fields.length; i++) {\n        if (this.options.fields[i].match(/^(OBJECTID|FID|OID|ID)$/i)) {\n          oidCheck = true;\n        }\n      }\n      if (oidCheck === false) {\n        warn('no known esriFieldTypeOID field detected in fields Array.  Please add an attribute field containing unique IDs to ensure the layer can be drawn correctly.');\n      }\n    }\n    if (this.options.timeField.start && this.options.timeField.end) {\n      this._startTimeIndex = new BinarySearchIndex();\n      this._endTimeIndex = new BinarySearchIndex();\n    } else if (this.options.timeField) {\n      this._timeIndex = new BinarySearchIndex();\n    }\n    this._cache = {};\n    this._currentSnapshot = []; // cache of what layers should be active\n    this._activeRequests = 0;\n  },\n  /**\r\n   * Layer Interface\r\n   */\n\n  onAdd: function (map) {\n    // include 'Powered by Esri' in map attribution\n    setEsriAttribution(map);\n    this.service.metadata(function (err, metadata) {\n      if (!err) {\n        var supportedFormats = metadata.supportedQueryFormats;\n\n        // Check if someone has requested that we don't use geoJSON, even if it's available\n        var forceJsonFormat = false;\n        if (this.service.options.isModern === false || this.options.fetchAllFeatures) {\n          forceJsonFormat = true;\n        }\n\n        // Unless we've been told otherwise, check to see whether service can emit GeoJSON natively\n        if (!forceJsonFormat && supportedFormats && supportedFormats.indexOf('geoJSON') !== -1) {\n          this.service.options.isModern = true;\n        }\n        if (metadata.objectIdField) {\n          this.service.options.idAttribute = metadata.objectIdField;\n        }\n\n        // add copyright text listed in service metadata\n        if (!this.options.attribution && map.attributionControl && metadata.copyrightText) {\n          this.options.attribution = metadata.copyrightText;\n          map.attributionControl.addAttribution(this.getAttribution());\n        }\n      }\n    }, this);\n    map.on('zoomend', this._handleZoomChange, this);\n    return FeatureGrid.prototype.onAdd.call(this, map);\n  },\n  onRemove: function (map) {\n    removeEsriAttribution(map);\n    map.off('zoomend', this._handleZoomChange, this);\n    return FeatureGrid.prototype.onRemove.call(this, map);\n  },\n  getAttribution: function () {\n    return this.options.attribution;\n  },\n  /**\r\n   * Feature Management\r\n   */\n\n  createCell: function (bounds, coords) {\n    // dont fetch features outside the scale range defined for the layer\n    if (this._visibleZoom()) {\n      this._requestFeatures(bounds, coords);\n    }\n  },\n  _requestFeatures: function (bounds, coords, callback, offset) {\n    this._activeRequests++;\n\n    // default param\n    offset = offset || 0;\n    var originalWhere = this.options.where;\n\n    // our first active request fires loading\n    if (this._activeRequests === 1) {\n      this.fire('loading', {\n        bounds: bounds\n      }, true);\n    }\n    return this._buildQuery(bounds, offset).run(function (error, featureCollection, response) {\n      if (response && response.exceededTransferLimit) {\n        this.fire('drawlimitexceeded');\n      }\n\n      // the where changed while this request was being run so don't it.\n      if (this.options.where !== originalWhere) {\n        return;\n      }\n\n      // no error, features\n      if (!error && featureCollection && featureCollection.features.length) {\n        // schedule adding features until the next animation frame\n        Util.requestAnimFrame(Util.bind(function () {\n          this._addFeatures(featureCollection.features, coords);\n          this._postProcessFeatures(bounds);\n        }, this));\n      }\n\n      // no error, no features\n      if (!error && featureCollection && !featureCollection.features.length) {\n        this._postProcessFeatures(bounds);\n      }\n      if (error) {\n        this._postProcessFeatures(bounds);\n      }\n      if (callback) {\n        callback.call(this, error, featureCollection);\n      }\n      if (response && (response.exceededTransferLimit || response.properties && response.properties.exceededTransferLimit) && this.options.fetchAllFeatures) {\n        this._requestFeatures(bounds, coords, callback, offset + featureCollection.features.length);\n      }\n    }, this);\n  },\n  _postProcessFeatures: function (bounds) {\n    // deincrement the request counter now that we have processed features\n    this._activeRequests--;\n\n    // if there are no more active requests fire a load event for this view\n    if (this._activeRequests <= 0) {\n      this.fire('load', {\n        bounds: bounds\n      });\n    }\n  },\n  _cacheKey: function (coords) {\n    return coords.z + ':' + coords.x + ':' + coords.y;\n  },\n  _addFeatures: function (features, coords) {\n    // coords is optional - will be false if coming from addFeatures() function\n    if (coords) {\n      var key = this._cacheKey(coords);\n      this._cache[key] = this._cache[key] || [];\n    }\n    for (var i = features.length - 1; i >= 0; i--) {\n      var id = features[i].id;\n      if (this._currentSnapshot.indexOf(id) === -1) {\n        this._currentSnapshot.push(id);\n      }\n      if (typeof key !== 'undefined' && this._cache[key].indexOf(id) === -1) {\n        this._cache[key].push(id);\n      }\n    }\n    if (this.options.timeField) {\n      this._buildTimeIndexes(features);\n    }\n    this.createLayers(features);\n  },\n  _buildQuery: function (bounds, offset) {\n    var query = this.service.query().intersects(bounds).where(this.options.where).fields(this.options.fields).precision(this.options.precision);\n    if (this.options.fetchAllFeatures && !isNaN(parseInt(offset))) {\n      query = query.offset(offset);\n    }\n    query.params['resultType'] = 'tile';\n    if (this.options.requestParams) {\n      Util.extend(query.params, this.options.requestParams);\n    }\n    if (this.options.simplifyFactor) {\n      query.simplify(this._map, this.options.simplifyFactor);\n    }\n    if (this.options.timeFilterMode === 'server' && this.options.from && this.options.to) {\n      query.between(this.options.from, this.options.to);\n    }\n    return query;\n  },\n  /**\r\n   * Where Methods\r\n   */\n\n  setWhere: function (where, callback, context) {\n    this.options.where = where && where.length ? where : '1=1';\n    var oldSnapshot = [];\n    var newSnapshot = [];\n    var pendingRequests = 0;\n    var requestError = null;\n    var requestCallback = Util.bind(function (error, featureCollection) {\n      if (error) {\n        requestError = error;\n      }\n      if (featureCollection) {\n        for (var i = featureCollection.features.length - 1; i >= 0; i--) {\n          newSnapshot.push(featureCollection.features[i].id);\n        }\n      }\n      pendingRequests--;\n      if (pendingRequests <= 0 && this._visibleZoom() && where === this.options.where // the where is still the same so use this one\n      ) {\n        this._currentSnapshot = newSnapshot;\n        // schedule adding features for the next animation frame\n        Util.requestAnimFrame(Util.bind(function () {\n          this.removeLayers(oldSnapshot);\n          this.addLayers(newSnapshot);\n          if (callback) {\n            callback.call(context, requestError);\n          }\n        }, this));\n      }\n    }, this);\n    for (var i = this._currentSnapshot.length - 1; i >= 0; i--) {\n      oldSnapshot.push(this._currentSnapshot[i]);\n    }\n    this._cache = {};\n    for (var key in this._cells) {\n      pendingRequests++;\n      var coords = this._keyToCellCoords(key);\n      var bounds = this._cellCoordsToBounds(coords);\n      this._requestFeatures(bounds, coords, requestCallback);\n    }\n    return this;\n  },\n  getWhere: function () {\n    return this.options.where;\n  },\n  /**\r\n   * Time Range Methods\r\n   */\n\n  getTimeRange: function () {\n    return [this.options.from, this.options.to];\n  },\n  setTimeRange: function (from, to, callback, context) {\n    var oldFrom = this.options.from;\n    var oldTo = this.options.to;\n    var pendingRequests = 0;\n    var requestError = null;\n    var requestCallback = Util.bind(function (error) {\n      if (error) {\n        requestError = error;\n      }\n      this._filterExistingFeatures(oldFrom, oldTo, from, to);\n      pendingRequests--;\n      if (callback && pendingRequests <= 0) {\n        callback.call(context, requestError);\n      }\n    }, this);\n    this.options.from = from;\n    this.options.to = to;\n    this._filterExistingFeatures(oldFrom, oldTo, from, to);\n    if (this.options.timeFilterMode === 'server') {\n      for (var key in this._cells) {\n        pendingRequests++;\n        var coords = this._keyToCellCoords(key);\n        var bounds = this._cellCoordsToBounds(coords);\n        this._requestFeatures(bounds, coords, requestCallback);\n      }\n    }\n    return this;\n  },\n  refresh: function () {\n    this.setWhere(this.options.where);\n  },\n  _filterExistingFeatures: function (oldFrom, oldTo, newFrom, newTo) {\n    var layersToRemove = oldFrom && oldTo ? this._getFeaturesInTimeRange(oldFrom, oldTo) : this._currentSnapshot;\n    var layersToAdd = this._getFeaturesInTimeRange(newFrom, newTo);\n    if (layersToAdd.indexOf) {\n      for (var i = 0; i < layersToAdd.length; i++) {\n        var shouldRemoveLayer = layersToRemove.indexOf(layersToAdd[i]);\n        if (shouldRemoveLayer >= 0) {\n          layersToRemove.splice(shouldRemoveLayer, 1);\n        }\n      }\n    }\n\n    // schedule adding features until the next animation frame\n    Util.requestAnimFrame(Util.bind(function () {\n      this.removeLayers(layersToRemove);\n      this.addLayers(layersToAdd);\n    }, this));\n  },\n  _getFeaturesInTimeRange: function (start, end) {\n    var ids = [];\n    var search;\n    if (this.options.timeField.start && this.options.timeField.end) {\n      var startTimes = this._startTimeIndex.between(start, end);\n      var endTimes = this._endTimeIndex.between(start, end);\n      search = startTimes.concat(endTimes);\n    } else if (this._timeIndex) {\n      search = this._timeIndex.between(start, end);\n    } else {\n      warn('You must set timeField in the layer constructor in order to manipulate the start and end time filter.');\n      return [];\n    }\n    for (var i = search.length - 1; i >= 0; i--) {\n      ids.push(search[i].id);\n    }\n    return ids;\n  },\n  _buildTimeIndexes: function (geojson) {\n    var i;\n    var feature;\n    if (this.options.timeField.start && this.options.timeField.end) {\n      var startTimeEntries = [];\n      var endTimeEntries = [];\n      for (i = geojson.length - 1; i >= 0; i--) {\n        feature = geojson[i];\n        startTimeEntries.push({\n          id: feature.id,\n          value: new Date(feature.properties[this.options.timeField.start])\n        });\n        endTimeEntries.push({\n          id: feature.id,\n          value: new Date(feature.properties[this.options.timeField.end])\n        });\n      }\n      this._startTimeIndex.bulkAdd(startTimeEntries);\n      this._endTimeIndex.bulkAdd(endTimeEntries);\n    } else {\n      var timeEntries = [];\n      for (i = geojson.length - 1; i >= 0; i--) {\n        feature = geojson[i];\n        timeEntries.push({\n          id: feature.id,\n          value: new Date(feature.properties[this.options.timeField])\n        });\n      }\n      this._timeIndex.bulkAdd(timeEntries);\n    }\n  },\n  _featureWithinTimeRange: function (feature) {\n    if (!this.options.from || !this.options.to) {\n      return true;\n    }\n    var from = +this.options.from.valueOf();\n    var to = +this.options.to.valueOf();\n    if (typeof this.options.timeField === 'string') {\n      var date = +feature.properties[this.options.timeField];\n      return date >= from && date <= to;\n    }\n    if (this.options.timeField.start && this.options.timeField.end) {\n      var startDate = +feature.properties[this.options.timeField.start];\n      var endDate = +feature.properties[this.options.timeField.end];\n      return startDate >= from && startDate <= to || endDate >= from && endDate <= to || startDate <= from && endDate >= to;\n    }\n  },\n  _visibleZoom: function () {\n    // check to see whether the current zoom level of the map is within the optional limit defined for the FeatureLayer\n    if (!this._map) {\n      return false;\n    }\n    var zoom = this._map.getZoom();\n    if (zoom > this.options.maxZoom || zoom < this.options.minZoom) {\n      return false;\n    } else {\n      return true;\n    }\n  },\n  _handleZoomChange: function () {\n    if (!this._visibleZoom()) {\n      // if we have moved outside the visible zoom range clear the current snapshot, no layers should be active\n      this.removeLayers(this._currentSnapshot);\n      this._currentSnapshot = [];\n    } else {\n      /*\r\n      for every cell in this._cells\r\n        1. Get the cache key for the coords of the cell\r\n        2. If this._cache[key] exists it will be an array of feature IDs.\r\n        3. Call this.addLayers(this._cache[key]) to instruct the feature layer to add the layers back.\r\n      */\n      for (var i in this._cells) {\n        var coords = this._cells[i].coords;\n        var key = this._cacheKey(coords);\n        if (this._cache[key]) {\n          this.addLayers(this._cache[key]);\n        }\n      }\n    }\n  },\n  /**\r\n   * Service Methods\r\n   */\n\n  authenticate: function (token) {\n    this.service.authenticate(token);\n    return this;\n  },\n  metadata: function (callback, context) {\n    this.service.metadata(callback, context);\n    return this;\n  },\n  query: function () {\n    return this.service.query();\n  },\n  _getMetadata: function (callback) {\n    if (this._metadata) {\n      var error;\n      callback(error, this._metadata);\n    } else {\n      this.metadata(Util.bind(function (error, response) {\n        this._metadata = response;\n        callback(error, this._metadata);\n      }, this));\n    }\n  },\n  addFeature: function (feature, callback, context) {\n    this.addFeatures(feature, callback, context);\n  },\n  addFeatures: function (features, callback, context) {\n    this._getMetadata(Util.bind(function (error, metadata) {\n      if (error) {\n        if (callback) {\n          callback.call(this, error, null);\n        }\n        return;\n      }\n      // GeoJSON featureCollection or simple feature\n      var featuresArray = features.features ? features.features : [features];\n      this.service.addFeatures(features, Util.bind(function (error, response) {\n        if (!error) {\n          for (var i = featuresArray.length - 1; i >= 0; i--) {\n            // assign ID from result to appropriate objectid field from service metadata\n            featuresArray[i].properties[metadata.objectIdField] = featuresArray.length > 1 ? response[i].objectId : response.objectId;\n            // we also need to update the geojson id for createLayers() to function\n            featuresArray[i].id = featuresArray.length > 1 ? response[i].objectId : response.objectId;\n          }\n          this._addFeatures(featuresArray);\n        }\n        if (callback) {\n          callback.call(context, error, response);\n        }\n      }, this));\n    }, this));\n  },\n  updateFeature: function (feature, callback, context) {\n    this.updateFeatures(feature, callback, context);\n  },\n  updateFeatures: function (features, callback, context) {\n    // GeoJSON featureCollection or simple feature\n    var featuresArray = features.features ? features.features : [features];\n    this.service.updateFeatures(features, function (error, response) {\n      if (!error) {\n        for (var i = featuresArray.length - 1; i >= 0; i--) {\n          this.removeLayers([featuresArray[i].id], true);\n        }\n        this._addFeatures(featuresArray);\n      }\n      if (callback) {\n        callback.call(context, error, response);\n      }\n    }, this);\n  },\n  deleteFeature: function (id, callback, context) {\n    this.deleteFeatures(id, callback, context);\n  },\n  deleteFeatures: function (ids, callback, context) {\n    return this.service.deleteFeatures(ids, function (error, response) {\n      var responseArray = response.length ? response : [response];\n      if (!error && responseArray.length > 0) {\n        for (var i = responseArray.length - 1; i >= 0; i--) {\n          this.removeLayers([responseArray[i].objectId], true);\n        }\n      }\n      if (callback) {\n        callback.call(context, error, response);\n      }\n    }, this);\n  }\n});","map":{"version":3,"names":["Util","featureLayerService","getUrlParams","warn","setEsriAttribution","removeEsriAttribution","FeatureGrid","BinarySearchIndex","FeatureManager","extend","options","attribution","where","fields","from","to","timeField","timeFilterMode","simplifyFactor","precision","fetchAllFeatures","initialize","prototype","call","setOptions","service","addEventParent","oidCheck","i","length","match","start","end","_startTimeIndex","_endTimeIndex","_timeIndex","_cache","_currentSnapshot","_activeRequests","onAdd","map","metadata","err","supportedFormats","supportedQueryFormats","forceJsonFormat","isModern","indexOf","objectIdField","idAttribute","attributionControl","copyrightText","addAttribution","getAttribution","on","_handleZoomChange","onRemove","off","createCell","bounds","coords","_visibleZoom","_requestFeatures","callback","offset","originalWhere","fire","_buildQuery","run","error","featureCollection","response","exceededTransferLimit","features","requestAnimFrame","bind","_addFeatures","_postProcessFeatures","properties","_cacheKey","z","x","y","key","id","push","_buildTimeIndexes","createLayers","query","intersects","isNaN","parseInt","params","requestParams","simplify","_map","between","setWhere","context","oldSnapshot","newSnapshot","pendingRequests","requestError","requestCallback","removeLayers","addLayers","_cells","_keyToCellCoords","_cellCoordsToBounds","getWhere","getTimeRange","setTimeRange","oldFrom","oldTo","_filterExistingFeatures","refresh","newFrom","newTo","layersToRemove","_getFeaturesInTimeRange","layersToAdd","shouldRemoveLayer","splice","ids","search","startTimes","endTimes","concat","geojson","feature","startTimeEntries","endTimeEntries","value","Date","bulkAdd","timeEntries","_featureWithinTimeRange","valueOf","date","startDate","endDate","zoom","getZoom","maxZoom","minZoom","authenticate","token","_getMetadata","_metadata","addFeature","addFeatures","featuresArray","objectId","updateFeature","updateFeatures","deleteFeature","deleteFeatures","responseArray"],"sources":["E:/Working/IP_proj/EcosystemCivi/ecosys/node_modules/esri-leaflet/src/Layers/FeatureLayer/FeatureManager.js"],"sourcesContent":["import { Util } from 'leaflet';\r\nimport featureLayerService from '../../Services/FeatureLayerService';\r\nimport {\r\n  getUrlParams,\r\n  warn,\r\n  setEsriAttribution,\r\n  removeEsriAttribution\r\n} from '../../Util';\r\nimport { FeatureGrid } from './FeatureGrid';\r\nimport BinarySearchIndex from 'tiny-binary-search';\r\n\r\nexport var FeatureManager = FeatureGrid.extend({\r\n  /**\r\n   * Options\r\n   */\r\n\r\n  options: {\r\n    attribution: null,\r\n    where: '1=1',\r\n    fields: ['*'],\r\n    from: false,\r\n    to: false,\r\n    timeField: false,\r\n    timeFilterMode: 'server',\r\n    simplifyFactor: 0,\r\n    precision: 6,\r\n    fetchAllFeatures: false\r\n  },\r\n\r\n  /**\r\n   * Constructor\r\n   */\r\n\r\n  initialize: function (options) {\r\n    FeatureGrid.prototype.initialize.call(this, options);\r\n\r\n    options = getUrlParams(options);\r\n    options = Util.setOptions(this, options);\r\n\r\n    this.service = featureLayerService(options);\r\n    this.service.addEventParent(this);\r\n\r\n    // use case insensitive regex to look for common fieldnames used for indexing\r\n    if (this.options.fields[0] !== '*') {\r\n      var oidCheck = false;\r\n      for (var i = 0; i < this.options.fields.length; i++) {\r\n        if (this.options.fields[i].match(/^(OBJECTID|FID|OID|ID)$/i)) {\r\n          oidCheck = true;\r\n        }\r\n      }\r\n      if (oidCheck === false) {\r\n        warn(\r\n          'no known esriFieldTypeOID field detected in fields Array.  Please add an attribute field containing unique IDs to ensure the layer can be drawn correctly.'\r\n        );\r\n      }\r\n    }\r\n\r\n    if (this.options.timeField.start && this.options.timeField.end) {\r\n      this._startTimeIndex = new BinarySearchIndex();\r\n      this._endTimeIndex = new BinarySearchIndex();\r\n    } else if (this.options.timeField) {\r\n      this._timeIndex = new BinarySearchIndex();\r\n    }\r\n\r\n    this._cache = {};\r\n    this._currentSnapshot = []; // cache of what layers should be active\r\n    this._activeRequests = 0;\r\n  },\r\n\r\n  /**\r\n   * Layer Interface\r\n   */\r\n\r\n  onAdd: function (map) {\r\n    // include 'Powered by Esri' in map attribution\r\n    setEsriAttribution(map);\r\n\r\n    this.service.metadata(function (err, metadata) {\r\n      if (!err) {\r\n        var supportedFormats = metadata.supportedQueryFormats;\r\n\r\n        // Check if someone has requested that we don't use geoJSON, even if it's available\r\n        var forceJsonFormat = false;\r\n        if (\r\n          this.service.options.isModern === false ||\r\n          this.options.fetchAllFeatures\r\n        ) {\r\n          forceJsonFormat = true;\r\n        }\r\n\r\n        // Unless we've been told otherwise, check to see whether service can emit GeoJSON natively\r\n        if (\r\n          !forceJsonFormat &&\r\n          supportedFormats &&\r\n          supportedFormats.indexOf('geoJSON') !== -1\r\n        ) {\r\n          this.service.options.isModern = true;\r\n        }\r\n\r\n        if (metadata.objectIdField) {\r\n          this.service.options.idAttribute = metadata.objectIdField;\r\n        }\r\n\r\n        // add copyright text listed in service metadata\r\n        if (\r\n          !this.options.attribution &&\r\n          map.attributionControl &&\r\n          metadata.copyrightText\r\n        ) {\r\n          this.options.attribution = metadata.copyrightText;\r\n          map.attributionControl.addAttribution(this.getAttribution());\r\n        }\r\n      }\r\n    }, this);\r\n\r\n    map.on('zoomend', this._handleZoomChange, this);\r\n\r\n    return FeatureGrid.prototype.onAdd.call(this, map);\r\n  },\r\n\r\n  onRemove: function (map) {\r\n    removeEsriAttribution(map);\r\n    map.off('zoomend', this._handleZoomChange, this);\r\n\r\n    return FeatureGrid.prototype.onRemove.call(this, map);\r\n  },\r\n\r\n  getAttribution: function () {\r\n    return this.options.attribution;\r\n  },\r\n\r\n  /**\r\n   * Feature Management\r\n   */\r\n\r\n  createCell: function (bounds, coords) {\r\n    // dont fetch features outside the scale range defined for the layer\r\n    if (this._visibleZoom()) {\r\n      this._requestFeatures(bounds, coords);\r\n    }\r\n  },\r\n\r\n  _requestFeatures: function (bounds, coords, callback, offset) {\r\n    this._activeRequests++;\r\n\r\n    // default param\r\n    offset = offset || 0;\r\n\r\n    var originalWhere = this.options.where;\r\n\r\n    // our first active request fires loading\r\n    if (this._activeRequests === 1) {\r\n      this.fire(\r\n        'loading',\r\n        {\r\n          bounds: bounds\r\n        },\r\n        true\r\n      );\r\n    }\r\n\r\n    return this._buildQuery(bounds, offset).run(function (\r\n      error,\r\n      featureCollection,\r\n      response\r\n    ) {\r\n      if (response && response.exceededTransferLimit) {\r\n        this.fire('drawlimitexceeded');\r\n      }\r\n\r\n      // the where changed while this request was being run so don't it.\r\n      if (this.options.where !== originalWhere) {\r\n        return;\r\n      }\r\n\r\n      // no error, features\r\n      if (!error && featureCollection && featureCollection.features.length) {\r\n        // schedule adding features until the next animation frame\r\n        Util.requestAnimFrame(\r\n          Util.bind(function () {\r\n            this._addFeatures(featureCollection.features, coords);\r\n            this._postProcessFeatures(bounds);\r\n          }, this)\r\n        );\r\n      }\r\n\r\n      // no error, no features\r\n      if (!error && featureCollection && !featureCollection.features.length) {\r\n        this._postProcessFeatures(bounds);\r\n      }\r\n\r\n      if (error) {\r\n        this._postProcessFeatures(bounds);\r\n      }\r\n\r\n      if (callback) {\r\n        callback.call(this, error, featureCollection);\r\n      }\r\n      if (\r\n        response &&\r\n        (response.exceededTransferLimit ||\r\n          (response.properties && response.properties.exceededTransferLimit)) &&\r\n        this.options.fetchAllFeatures\r\n      ) {\r\n        this._requestFeatures(\r\n          bounds,\r\n          coords,\r\n          callback,\r\n          offset + featureCollection.features.length\r\n        );\r\n      }\r\n    },\r\n    this);\r\n  },\r\n\r\n  _postProcessFeatures: function (bounds) {\r\n    // deincrement the request counter now that we have processed features\r\n    this._activeRequests--;\r\n\r\n    // if there are no more active requests fire a load event for this view\r\n    if (this._activeRequests <= 0) {\r\n      this.fire('load', {\r\n        bounds: bounds\r\n      });\r\n    }\r\n  },\r\n\r\n  _cacheKey: function (coords) {\r\n    return coords.z + ':' + coords.x + ':' + coords.y;\r\n  },\r\n\r\n  _addFeatures: function (features, coords) {\r\n    // coords is optional - will be false if coming from addFeatures() function\r\n    if (coords) {\r\n      var key = this._cacheKey(coords);\r\n      this._cache[key] = this._cache[key] || [];\r\n    }\r\n\r\n    for (var i = features.length - 1; i >= 0; i--) {\r\n      var id = features[i].id;\r\n\r\n      if (this._currentSnapshot.indexOf(id) === -1) {\r\n        this._currentSnapshot.push(id);\r\n      }\r\n      if (typeof key !== 'undefined' && this._cache[key].indexOf(id) === -1) {\r\n        this._cache[key].push(id);\r\n      }\r\n    }\r\n\r\n    if (this.options.timeField) {\r\n      this._buildTimeIndexes(features);\r\n    }\r\n\r\n    this.createLayers(features);\r\n  },\r\n\r\n  _buildQuery: function (bounds, offset) {\r\n    var query = this.service\r\n      .query()\r\n      .intersects(bounds)\r\n      .where(this.options.where)\r\n      .fields(this.options.fields)\r\n      .precision(this.options.precision);\r\n\r\n    if (this.options.fetchAllFeatures && !isNaN(parseInt(offset))) {\r\n      query = query.offset(offset);\r\n    }\r\n\r\n    query.params['resultType'] = 'tile';\r\n\r\n    if (this.options.requestParams) {\r\n      Util.extend(query.params, this.options.requestParams);\r\n    }\r\n\r\n    if (this.options.simplifyFactor) {\r\n      query.simplify(this._map, this.options.simplifyFactor);\r\n    }\r\n\r\n    if (\r\n      this.options.timeFilterMode === 'server' &&\r\n      this.options.from &&\r\n      this.options.to\r\n    ) {\r\n      query.between(this.options.from, this.options.to);\r\n    }\r\n\r\n    return query;\r\n  },\r\n\r\n  /**\r\n   * Where Methods\r\n   */\r\n\r\n  setWhere: function (where, callback, context) {\r\n    this.options.where = where && where.length ? where : '1=1';\r\n\r\n    var oldSnapshot = [];\r\n    var newSnapshot = [];\r\n    var pendingRequests = 0;\r\n    var requestError = null;\r\n    var requestCallback = Util.bind(function (error, featureCollection) {\r\n      if (error) {\r\n        requestError = error;\r\n      }\r\n\r\n      if (featureCollection) {\r\n        for (var i = featureCollection.features.length - 1; i >= 0; i--) {\r\n          newSnapshot.push(featureCollection.features[i].id);\r\n        }\r\n      }\r\n\r\n      pendingRequests--;\r\n\r\n      if (\r\n        pendingRequests <= 0 &&\r\n        this._visibleZoom() &&\r\n        where === this.options.where // the where is still the same so use this one\r\n      ) {\r\n        this._currentSnapshot = newSnapshot;\r\n        // schedule adding features for the next animation frame\r\n        Util.requestAnimFrame(\r\n          Util.bind(function () {\r\n            this.removeLayers(oldSnapshot);\r\n            this.addLayers(newSnapshot);\r\n            if (callback) {\r\n              callback.call(context, requestError);\r\n            }\r\n          }, this)\r\n        );\r\n      }\r\n    }, this);\r\n\r\n    for (var i = this._currentSnapshot.length - 1; i >= 0; i--) {\r\n      oldSnapshot.push(this._currentSnapshot[i]);\r\n    }\r\n\r\n    this._cache = {};\r\n\r\n    for (var key in this._cells) {\r\n      pendingRequests++;\r\n      var coords = this._keyToCellCoords(key);\r\n      var bounds = this._cellCoordsToBounds(coords);\r\n      this._requestFeatures(bounds, coords, requestCallback);\r\n    }\r\n\r\n    return this;\r\n  },\r\n\r\n  getWhere: function () {\r\n    return this.options.where;\r\n  },\r\n\r\n  /**\r\n   * Time Range Methods\r\n   */\r\n\r\n  getTimeRange: function () {\r\n    return [this.options.from, this.options.to];\r\n  },\r\n\r\n  setTimeRange: function (from, to, callback, context) {\r\n    var oldFrom = this.options.from;\r\n    var oldTo = this.options.to;\r\n    var pendingRequests = 0;\r\n    var requestError = null;\r\n    var requestCallback = Util.bind(function (error) {\r\n      if (error) {\r\n        requestError = error;\r\n      }\r\n      this._filterExistingFeatures(oldFrom, oldTo, from, to);\r\n\r\n      pendingRequests--;\r\n\r\n      if (callback && pendingRequests <= 0) {\r\n        callback.call(context, requestError);\r\n      }\r\n    }, this);\r\n\r\n    this.options.from = from;\r\n    this.options.to = to;\r\n\r\n    this._filterExistingFeatures(oldFrom, oldTo, from, to);\r\n\r\n    if (this.options.timeFilterMode === 'server') {\r\n      for (var key in this._cells) {\r\n        pendingRequests++;\r\n        var coords = this._keyToCellCoords(key);\r\n        var bounds = this._cellCoordsToBounds(coords);\r\n        this._requestFeatures(bounds, coords, requestCallback);\r\n      }\r\n    }\r\n\r\n    return this;\r\n  },\r\n\r\n  refresh: function () {\r\n    this.setWhere(this.options.where);\r\n  },\r\n\r\n  _filterExistingFeatures: function (oldFrom, oldTo, newFrom, newTo) {\r\n    var layersToRemove =\r\n      oldFrom && oldTo\r\n        ? this._getFeaturesInTimeRange(oldFrom, oldTo)\r\n        : this._currentSnapshot;\r\n    var layersToAdd = this._getFeaturesInTimeRange(newFrom, newTo);\r\n\r\n    if (layersToAdd.indexOf) {\r\n      for (var i = 0; i < layersToAdd.length; i++) {\r\n        var shouldRemoveLayer = layersToRemove.indexOf(layersToAdd[i]);\r\n        if (shouldRemoveLayer >= 0) {\r\n          layersToRemove.splice(shouldRemoveLayer, 1);\r\n        }\r\n      }\r\n    }\r\n\r\n    // schedule adding features until the next animation frame\r\n    Util.requestAnimFrame(\r\n      Util.bind(function () {\r\n        this.removeLayers(layersToRemove);\r\n        this.addLayers(layersToAdd);\r\n      }, this)\r\n    );\r\n  },\r\n\r\n  _getFeaturesInTimeRange: function (start, end) {\r\n    var ids = [];\r\n    var search;\r\n\r\n    if (this.options.timeField.start && this.options.timeField.end) {\r\n      var startTimes = this._startTimeIndex.between(start, end);\r\n      var endTimes = this._endTimeIndex.between(start, end);\r\n      search = startTimes.concat(endTimes);\r\n    } else if (this._timeIndex) {\r\n      search = this._timeIndex.between(start, end);\r\n    } else {\r\n      warn(\r\n        'You must set timeField in the layer constructor in order to manipulate the start and end time filter.'\r\n      );\r\n      return [];\r\n    }\r\n\r\n    for (var i = search.length - 1; i >= 0; i--) {\r\n      ids.push(search[i].id);\r\n    }\r\n\r\n    return ids;\r\n  },\r\n\r\n  _buildTimeIndexes: function (geojson) {\r\n    var i;\r\n    var feature;\r\n    if (this.options.timeField.start && this.options.timeField.end) {\r\n      var startTimeEntries = [];\r\n      var endTimeEntries = [];\r\n      for (i = geojson.length - 1; i >= 0; i--) {\r\n        feature = geojson[i];\r\n        startTimeEntries.push({\r\n          id: feature.id,\r\n          value: new Date(feature.properties[this.options.timeField.start])\r\n        });\r\n        endTimeEntries.push({\r\n          id: feature.id,\r\n          value: new Date(feature.properties[this.options.timeField.end])\r\n        });\r\n      }\r\n      this._startTimeIndex.bulkAdd(startTimeEntries);\r\n      this._endTimeIndex.bulkAdd(endTimeEntries);\r\n    } else {\r\n      var timeEntries = [];\r\n      for (i = geojson.length - 1; i >= 0; i--) {\r\n        feature = geojson[i];\r\n        timeEntries.push({\r\n          id: feature.id,\r\n          value: new Date(feature.properties[this.options.timeField])\r\n        });\r\n      }\r\n\r\n      this._timeIndex.bulkAdd(timeEntries);\r\n    }\r\n  },\r\n\r\n  _featureWithinTimeRange: function (feature) {\r\n    if (!this.options.from || !this.options.to) {\r\n      return true;\r\n    }\r\n\r\n    var from = +this.options.from.valueOf();\r\n    var to = +this.options.to.valueOf();\r\n\r\n    if (typeof this.options.timeField === 'string') {\r\n      var date = +feature.properties[this.options.timeField];\r\n      return date >= from && date <= to;\r\n    }\r\n\r\n    if (this.options.timeField.start && this.options.timeField.end) {\r\n      var startDate = +feature.properties[this.options.timeField.start];\r\n      var endDate = +feature.properties[this.options.timeField.end];\r\n      return (\r\n        (startDate >= from && startDate <= to) ||\r\n        (endDate >= from && endDate <= to) ||\r\n        (startDate <= from && endDate >= to)\r\n      );\r\n    }\r\n  },\r\n\r\n  _visibleZoom: function () {\r\n    // check to see whether the current zoom level of the map is within the optional limit defined for the FeatureLayer\r\n    if (!this._map) {\r\n      return false;\r\n    }\r\n    var zoom = this._map.getZoom();\r\n    if (zoom > this.options.maxZoom || zoom < this.options.minZoom) {\r\n      return false;\r\n    } else {\r\n      return true;\r\n    }\r\n  },\r\n\r\n  _handleZoomChange: function () {\r\n    if (!this._visibleZoom()) {\r\n      // if we have moved outside the visible zoom range clear the current snapshot, no layers should be active\r\n      this.removeLayers(this._currentSnapshot);\r\n      this._currentSnapshot = [];\r\n    } else {\r\n      /*\r\n      for every cell in this._cells\r\n        1. Get the cache key for the coords of the cell\r\n        2. If this._cache[key] exists it will be an array of feature IDs.\r\n        3. Call this.addLayers(this._cache[key]) to instruct the feature layer to add the layers back.\r\n      */\r\n      for (var i in this._cells) {\r\n        var coords = this._cells[i].coords;\r\n        var key = this._cacheKey(coords);\r\n        if (this._cache[key]) {\r\n          this.addLayers(this._cache[key]);\r\n        }\r\n      }\r\n    }\r\n  },\r\n\r\n  /**\r\n   * Service Methods\r\n   */\r\n\r\n  authenticate: function (token) {\r\n    this.service.authenticate(token);\r\n    return this;\r\n  },\r\n\r\n  metadata: function (callback, context) {\r\n    this.service.metadata(callback, context);\r\n    return this;\r\n  },\r\n\r\n  query: function () {\r\n    return this.service.query();\r\n  },\r\n\r\n  _getMetadata: function (callback) {\r\n    if (this._metadata) {\r\n      var error;\r\n      callback(error, this._metadata);\r\n    } else {\r\n      this.metadata(\r\n        Util.bind(function (error, response) {\r\n          this._metadata = response;\r\n          callback(error, this._metadata);\r\n        }, this)\r\n      );\r\n    }\r\n  },\r\n\r\n  addFeature: function (feature, callback, context) {\r\n    this.addFeatures(feature, callback, context);\r\n  },\r\n\r\n  addFeatures: function (features, callback, context) {\r\n    this._getMetadata(\r\n      Util.bind(function (error, metadata) {\r\n        if (error) {\r\n          if (callback) {\r\n            callback.call(this, error, null);\r\n          }\r\n          return;\r\n        }\r\n        // GeoJSON featureCollection or simple feature\r\n        var featuresArray = features.features ? features.features : [features];\r\n\r\n        this.service.addFeatures(\r\n          features,\r\n          Util.bind(function (error, response) {\r\n            if (!error) {\r\n              for (var i = featuresArray.length - 1; i >= 0; i--) {\r\n                // assign ID from result to appropriate objectid field from service metadata\r\n                featuresArray[i].properties[metadata.objectIdField] =\r\n                  featuresArray.length > 1\r\n                    ? response[i].objectId\r\n                    : response.objectId;\r\n                // we also need to update the geojson id for createLayers() to function\r\n                featuresArray[i].id =\r\n                  featuresArray.length > 1\r\n                    ? response[i].objectId\r\n                    : response.objectId;\r\n              }\r\n              this._addFeatures(featuresArray);\r\n            }\r\n\r\n            if (callback) {\r\n              callback.call(context, error, response);\r\n            }\r\n          }, this)\r\n        );\r\n      }, this)\r\n    );\r\n  },\r\n\r\n  updateFeature: function (feature, callback, context) {\r\n    this.updateFeatures(feature, callback, context);\r\n  },\r\n\r\n  updateFeatures: function (features, callback, context) {\r\n    // GeoJSON featureCollection or simple feature\r\n    var featuresArray = features.features ? features.features : [features];\r\n    this.service.updateFeatures(\r\n      features,\r\n      function (error, response) {\r\n        if (!error) {\r\n          for (var i = featuresArray.length - 1; i >= 0; i--) {\r\n            this.removeLayers([featuresArray[i].id], true);\r\n          }\r\n          this._addFeatures(featuresArray);\r\n        }\r\n\r\n        if (callback) {\r\n          callback.call(context, error, response);\r\n        }\r\n      },\r\n      this\r\n    );\r\n  },\r\n\r\n  deleteFeature: function (id, callback, context) {\r\n    this.deleteFeatures(id, callback, context);\r\n  },\r\n\r\n  deleteFeatures: function (ids, callback, context) {\r\n    return this.service.deleteFeatures(\r\n      ids,\r\n      function (error, response) {\r\n        var responseArray = response.length ? response : [response];\r\n        if (!error && responseArray.length > 0) {\r\n          for (var i = responseArray.length - 1; i >= 0; i--) {\r\n            this.removeLayers([responseArray[i].objectId], true);\r\n          }\r\n        }\r\n        if (callback) {\r\n          callback.call(context, error, response);\r\n        }\r\n      },\r\n      this\r\n    );\r\n  }\r\n});\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}