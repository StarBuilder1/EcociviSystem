{"ast":null,"code":"import \"core-js/modules/es.array.push.js\";\nimport { Util, Evented } from 'leaflet';\nimport { cors } from '../Support';\nimport { cleanUrl, getUrlParams } from '../Util';\nimport Request from '../Request';\nexport var Service = Evented.extend({\n  options: {\n    proxy: false,\n    useCors: cors,\n    timeout: 0\n  },\n  initialize: function (options) {\n    options = options || {};\n    this._requestQueue = [];\n    this._authenticating = false;\n    Util.setOptions(this, options);\n    this.options.url = cleanUrl(this.options.url);\n  },\n  get: function (path, params, callback, context) {\n    return this._request('get', path, params, callback, context);\n  },\n  post: function (path, params, callback, context) {\n    return this._request('post', path, params, callback, context);\n  },\n  request: function (path, params, callback, context) {\n    return this._request('request', path, params, callback, context);\n  },\n  metadata: function (callback, context) {\n    return this._request('get', '', {}, callback, context);\n  },\n  authenticate: function (token) {\n    this._authenticating = false;\n    this.options.token = token;\n    this._runQueue();\n    return this;\n  },\n  getTimeout: function () {\n    return this.options.timeout;\n  },\n  setTimeout: function (timeout) {\n    this.options.timeout = timeout;\n  },\n  _request: function (method, path, params, callback, context) {\n    this.fire('requeststart', {\n      url: this.options.url + path,\n      params: params,\n      method: method\n    }, true);\n    var wrappedCallback = this._createServiceCallback(method, path, params, callback, context);\n    if (this.options.token) {\n      params.token = this.options.token;\n    }\n    if (this.options.requestParams) {\n      Util.extend(params, this.options.requestParams);\n    }\n    if (this._authenticating) {\n      this._requestQueue.push([method, path, params, callback, context]);\n    } else {\n      var url = this.options.proxy ? this.options.proxy + '?' + this.options.url + path : this.options.url + path;\n      if ((method === 'get' || method === 'request') && !this.options.useCors) {\n        return Request.get.JSONP(url, params, wrappedCallback, context);\n      } else {\n        return Request[method](url, params, wrappedCallback, context);\n      }\n    }\n  },\n  _createServiceCallback: function (method, path, params, callback, context) {\n    return Util.bind(function (error, response) {\n      if (error && (error.code === 499 || error.code === 498)) {\n        this._authenticating = true;\n        this._requestQueue.push([method, path, params, callback, context]);\n\n        // fire an event for users to handle and re-authenticate\n        this.fire('authenticationrequired', {\n          authenticate: Util.bind(this.authenticate, this)\n        }, true);\n\n        // if the user has access to a callback they can handle the auth error\n        error.authenticate = Util.bind(this.authenticate, this);\n      }\n      callback.call(context, error, response);\n      if (error) {\n        this.fire('requesterror', {\n          url: this.options.url + path,\n          params: params,\n          message: error.message,\n          code: error.code,\n          method: method\n        }, true);\n      } else {\n        this.fire('requestsuccess', {\n          url: this.options.url + path,\n          params: params,\n          response: response,\n          method: method\n        }, true);\n      }\n      this.fire('requestend', {\n        url: this.options.url + path,\n        params: params,\n        method: method\n      }, true);\n    }, this);\n  },\n  _runQueue: function () {\n    for (var i = this._requestQueue.length - 1; i >= 0; i--) {\n      var request = this._requestQueue[i];\n      var method = request.shift();\n      this[method].apply(this, request);\n    }\n    this._requestQueue = [];\n  }\n});\nexport function service(options) {\n  options = getUrlParams(options);\n  return new Service(options);\n}\nexport default service;","map":{"version":3,"names":["Util","Evented","cors","cleanUrl","getUrlParams","Request","Service","extend","options","proxy","useCors","timeout","initialize","_requestQueue","_authenticating","setOptions","url","get","path","params","callback","context","_request","post","request","metadata","authenticate","token","_runQueue","getTimeout","setTimeout","method","fire","wrappedCallback","_createServiceCallback","requestParams","push","JSONP","bind","error","response","code","call","message","i","length","shift","apply","service"],"sources":["E:/Working/IP_proj/EcosystemCivi/ecosys/node_modules/esri-leaflet/src/Services/Service.js"],"sourcesContent":["import { Util, Evented } from 'leaflet';\r\nimport { cors } from '../Support';\r\nimport { cleanUrl, getUrlParams } from '../Util';\r\nimport Request from '../Request';\r\n\r\nexport var Service = Evented.extend({\r\n\r\n  options: {\r\n    proxy: false,\r\n    useCors: cors,\r\n    timeout: 0\r\n  },\r\n\r\n  initialize: function (options) {\r\n    options = options || {};\r\n    this._requestQueue = [];\r\n    this._authenticating = false;\r\n    Util.setOptions(this, options);\r\n    this.options.url = cleanUrl(this.options.url);\r\n  },\r\n\r\n  get: function (path, params, callback, context) {\r\n    return this._request('get', path, params, callback, context);\r\n  },\r\n\r\n  post: function (path, params, callback, context) {\r\n    return this._request('post', path, params, callback, context);\r\n  },\r\n\r\n  request: function (path, params, callback, context) {\r\n    return this._request('request', path, params, callback, context);\r\n  },\r\n\r\n  metadata: function (callback, context) {\r\n    return this._request('get', '', {}, callback, context);\r\n  },\r\n\r\n  authenticate: function (token) {\r\n    this._authenticating = false;\r\n    this.options.token = token;\r\n    this._runQueue();\r\n    return this;\r\n  },\r\n\r\n  getTimeout: function () {\r\n    return this.options.timeout;\r\n  },\r\n\r\n  setTimeout: function (timeout) {\r\n    this.options.timeout = timeout;\r\n  },\r\n\r\n  _request: function (method, path, params, callback, context) {\r\n    this.fire('requeststart', {\r\n      url: this.options.url + path,\r\n      params: params,\r\n      method: method\r\n    }, true);\r\n\r\n    var wrappedCallback = this._createServiceCallback(method, path, params, callback, context);\r\n\r\n    if (this.options.token) {\r\n      params.token = this.options.token;\r\n    }\r\n    if (this.options.requestParams) {\r\n      Util.extend(params, this.options.requestParams);\r\n    }\r\n    if (this._authenticating) {\r\n      this._requestQueue.push([method, path, params, callback, context]);\r\n    } else {\r\n      var url = (this.options.proxy) ? this.options.proxy + '?' + this.options.url + path : this.options.url + path;\r\n\r\n      if ((method === 'get' || method === 'request') && !this.options.useCors) {\r\n        return Request.get.JSONP(url, params, wrappedCallback, context);\r\n      } else {\r\n        return Request[method](url, params, wrappedCallback, context);\r\n      }\r\n    }\r\n  },\r\n\r\n  _createServiceCallback: function (method, path, params, callback, context) {\r\n    return Util.bind(function (error, response) {\r\n      if (error && (error.code === 499 || error.code === 498)) {\r\n        this._authenticating = true;\r\n\r\n        this._requestQueue.push([method, path, params, callback, context]);\r\n\r\n        // fire an event for users to handle and re-authenticate\r\n        this.fire('authenticationrequired', {\r\n          authenticate: Util.bind(this.authenticate, this)\r\n        }, true);\r\n\r\n        // if the user has access to a callback they can handle the auth error\r\n        error.authenticate = Util.bind(this.authenticate, this);\r\n      }\r\n\r\n      callback.call(context, error, response);\r\n\r\n      if (error) {\r\n        this.fire('requesterror', {\r\n          url: this.options.url + path,\r\n          params: params,\r\n          message: error.message,\r\n          code: error.code,\r\n          method: method\r\n        }, true);\r\n      } else {\r\n        this.fire('requestsuccess', {\r\n          url: this.options.url + path,\r\n          params: params,\r\n          response: response,\r\n          method: method\r\n        }, true);\r\n      }\r\n\r\n      this.fire('requestend', {\r\n        url: this.options.url + path,\r\n        params: params,\r\n        method: method\r\n      }, true);\r\n    }, this);\r\n  },\r\n\r\n  _runQueue: function () {\r\n    for (var i = this._requestQueue.length - 1; i >= 0; i--) {\r\n      var request = this._requestQueue[i];\r\n      var method = request.shift();\r\n      this[method].apply(this, request);\r\n    }\r\n    this._requestQueue = [];\r\n  }\r\n});\r\n\r\nexport function service (options) {\r\n  options = getUrlParams(options);\r\n  return new Service(options);\r\n}\r\n\r\nexport default service;\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}